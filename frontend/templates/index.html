<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">
    <title>Gilbert · Diarization</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-tertiary: #f3f4f6;
            --border: #e5e7eb;
            --border-light: #f3f4f6;
            --text: #111827;
            --text-secondary: #6b7280;
            --text-tertiary: #9ca3af;
            --accent: #1e3a5f;
            --accent-light: #2d5a87;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        /* Layout */
        .app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            height: 64px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 32px;
            background: var(--bg);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo img {
            width: 32px;
            height: 32px;
            border-radius: 8px;
        }

        .logo-text {
            font-size: 17px;
            font-weight: 600;
            color: var(--text);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 18px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-light);
        }

        .btn-secondary {
            background: var(--bg);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            border-color: #d1d5db;
        }

        .btn svg {
            width: 16px;
            height: 16px;
        }

        /* Main Content */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .content {
            flex: 1;
            max-width: 960px;
            width: 100%;
            margin: 0 auto;
            padding: 48px 32px;
        }

        /* Upload Section */
        .upload-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
        }

        .upload-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .upload-header h1 {
            font-size: 32px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }

        .upload-header p {
            font-size: 16px;
            color: var(--text-secondary);
            max-width: 400px;
        }

        .upload-zone {
            width: 100%;
            max-width: 520px;
            background: var(--bg);
            border: 2px dashed var(--border);
            border-radius: 16px;
            padding: 56px 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .upload-zone:hover {
            border-color: var(--accent);
            background: var(--bg-secondary);
        }

        .upload-zone.drag-active {
            border-color: var(--accent);
            background: #f0f7ff;
            transform: scale(1.01);
        }

        .upload-icon {
            width: 56px;
            height: 56px;
            margin: 0 auto 20px;
            background: var(--bg-tertiary);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .upload-icon svg {
            width: 24px;
            height: 24px;
            color: var(--text-secondary);
        }

        .upload-text {
            font-size: 15px;
            font-weight: 500;
            color: var(--text);
            margin-bottom: 8px;
        }

        .upload-hint {
            font-size: 14px;
            color: var(--text-tertiary);
            margin-bottom: 20px;
        }

        .upload-formats {
            display: flex;
            justify-content: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        .format-tag {
            padding: 4px 10px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        /* Processing Section */
        .processing-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            text-align: center;
        }

        .processing-visual {
            width: 100px;
            height: 100px;
            margin-bottom: 32px;
        }

        .processing-logo {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .processing-info h2 {
            font-size: 20px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 8px;
        }

        .processing-status {
            font-size: 15px;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .processing-bar {
            width: 280px;
            height: 4px;
            background: var(--bg-tertiary);
            border-radius: 2px;
            overflow: hidden;
        }

        .processing-bar-fill {
            height: 100%;
            background: var(--accent);
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        /* Results Section */
        .results-section {
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .results-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 32px;
        }

        .results-title h2 {
            font-size: 24px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 4px;
        }

        .results-meta {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Timeline */
        .timeline-container {
            margin-bottom: 32px;
        }

        .timeline-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .timeline-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .timeline-legend {
            display: flex;
            gap: 16px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 3px;
        }

        .timeline {
            height: 40px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        .timeline-segment {
            position: absolute;
            height: 100%;
            opacity: 0.85;
            transition: opacity 0.15s;
            cursor: pointer;
        }

        .timeline-segment:hover {
            opacity: 1;
        }

        .timeline-time {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 12px;
            color: var(--text-tertiary);
            font-variant-numeric: tabular-nums;
        }

        /* Tracks */
        .tracks-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .track {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.15s ease;
        }

        .track:hover {
            border-color: #d1d5db;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .track-play {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
            flex-shrink: 0;
        }

        .track-play:hover {
            transform: scale(1.05);
            filter: brightness(1.1);
        }

        .track-play svg {
            width: 16px;
            height: 16px;
            color: white;
            margin-left: 2px;
        }

        .track-play .pause-icon {
            margin-left: 0;
        }

        .track-info {
            min-width: 140px;
        }

        .track-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .track-name-text {
            cursor: pointer;
            padding: 2px 4px;
            margin: -2px -4px;
            border-radius: 4px;
            transition: background 0.15s;
        }

        .track-name-text:hover {
            background: var(--bg-tertiary);
        }

        .track-name-input {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
            border: 1px solid var(--accent);
            border-radius: 4px;
            padding: 2px 6px;
            width: 120px;
            outline: none;
            background: var(--bg);
        }

        .track-meta {
            font-size: 13px;
            color: var(--text-tertiary);
        }

        /* Waveform WaveSurfer */
        .track-waveform-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 6px;
            min-width: 0;
        }

        .track-waveform {
            height: 64px;
            cursor: pointer;
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            background: var(--bg-tertiary);
        }

        .track-waveform ::part(cursor) {
            width: 2px !important;
            background: var(--accent) !important;
        }

        /* Zoom slider */
        .zoom-slider-container {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0 4px;
        }

        .zoom-slider {
            width: 80px;
            height: 4px;
            -webkit-appearance: none;
            appearance: none;
            background: var(--bg-tertiary);
            border-radius: 2px;
            outline: none;
            cursor: pointer;
        }

        .zoom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.15s;
        }

        .zoom-slider::-webkit-slider-thumb:hover {
            transform: scale(1.15);
        }

        .zoom-label {
            font-size: 11px;
            color: var(--text-tertiary);
            font-variant-numeric: tabular-nums;
        }

        .zoom-icon {
            width: 14px;
            height: 14px;
            color: var(--text-tertiary);
        }

        .track-time {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            font-variant-numeric: tabular-nums;
            min-width: 45px;
            text-align: right;
        }

        .track-download {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }

        .track-download:hover {
            background: var(--bg-secondary);
            color: var(--text);
            border-color: #d1d5db;
        }

        .track-download svg {
            width: 16px;
            height: 16px;
        }

        /* Error Section */
        .error-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            text-align: center;
        }

        .error-icon {
            width: 56px;
            height: 56px;
            margin-bottom: 20px;
            background: #fef2f2;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .error-icon svg {
            width: 24px;
            height: 24px;
            color: #ef4444;
        }

        .error-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 8px;
        }

        .error-message {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 24px;
            max-width: 400px;
        }

        /* Footer */
        .footer {
            padding: 24px 32px;
            text-align: center;
            border-top: 1px solid var(--border);
            background: var(--bg);
        }

        .footer-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 13px;
            color: var(--text-tertiary);
        }

        .footer-link {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.15s;
        }

        .footer-link:hover {
            color: var(--accent);
        }

        .pyannote-logo {
            height: 16px;
            opacity: 0.7;
            transition: opacity 0.15s;
        }

        .footer-link:hover .pyannote-logo {
            opacity: 1;
        }

        /* Utilities */
        .hidden { display: none !important; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #d1d5db; }

        /* Responsive */
        @media (max-width: 768px) {
            .header { padding: 0 20px; }
            .content { padding: 32px 20px; }
            .upload-header h1 { font-size: 26px; }
            .upload-zone { padding: 40px 24px; }
            .track { flex-wrap: wrap; }
            .track-waveform {
                order: 10;
                width: 100%;
                margin-top: 12px;
            }
            .track-info { flex: 1; }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <img src="{{ url_for('static', filename='images/WhatsApp_Image_2025-11-26_at_17.56.45__1_-removebg-preview.png') }}" alt="Gilbert">
                <span class="logo-text">Gilbert</span>
            </div>
            <div class="header-actions">
                <button id="new-file-btn" class="btn btn-secondary hidden">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    Nouveau fichier
                </button>
            </div>
        </header>

        <!-- Main -->
        <main class="main">
            <div class="content">
                <!-- Upload -->
                <div id="upload-section" class="upload-section">
                    <div class="upload-header">
                        <h1>Séparation de locuteurs</h1>
                        <p>Identifiez et isolez automatiquement chaque voix de vos fichiers audio</p>
                    </div>

                    <div id="upload-zone" class="upload-zone">
                        <div class="upload-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="17 8 12 3 7 8"/>
                                <line x1="12" y1="3" x2="12" y2="15"/>
                            </svg>
                        </div>
                        <div class="upload-text">Déposez votre fichier ici</div>
                        <div class="upload-hint">ou cliquez pour parcourir</div>
                        <div class="upload-formats">
                            <span class="format-tag">MP3</span>
                            <span class="format-tag">WAV</span>
                            <span class="format-tag">MP4</span>
                            <span class="format-tag">M4A</span>
                            <span class="format-tag">MOV</span>
                        </div>
                        <input type="file" id="file-input" accept=".mp3,.wav,.mp4,.mov,.m4a,.ogg,.flac,.webm,.aac" class="hidden">
                    </div>
                </div>

                <!-- Processing -->
                <div id="progress-section" class="processing-section hidden">
                    <div class="processing-visual">
                        <img src="{{ url_for('static', filename='images/loading-pingpong.gif') }}" alt="Chargement" class="processing-logo">
                    </div>
                    <div class="processing-info">
                        <h2 id="progress-percent">Analyse en cours...</h2>
                        <p id="progress-text" class="processing-status">Préparation du fichier</p>
                    </div>
                    <div class="processing-bar">
                        <div id="progress-bar-fill" class="processing-bar-fill" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Results -->
                <div id="results-section" class="results-section hidden">
                    <div class="results-header">
                        <div class="results-title">
                            <h2>Analyse terminée</h2>
                            <p class="results-meta">
                                <span id="speaker-count">0</span> locuteurs ·
                                <span id="segment-count">0</span> segments ·
                                <span id="total-duration">0:00</span>
                            </p>
                        </div>
                        <button id="download-all-btn" class="btn btn-primary">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7 10 12 15 17 10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                            Tout télécharger
                        </button>
                    </div>

                    <div class="timeline-container">
                        <div class="timeline-header">
                            <span class="timeline-label">Répartition temporelle</span>
                            <div id="timeline-legend" class="timeline-legend"></div>
                        </div>
                        <div id="timeline" class="timeline"></div>
                        <div class="timeline-time">
                            <span>0:00</span>
                            <span id="timeline-end">0:00</span>
                        </div>
                    </div>

                    <div id="tracks-list" class="tracks-container"></div>
                </div>

                <!-- Error -->
                <div id="error-section" class="error-section hidden">
                    <div class="error-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="8" x2="12" y2="12"/>
                            <line x1="12" y1="16" x2="12.01" y2="16"/>
                        </svg>
                    </div>
                    <div class="error-title">Une erreur est survenue</div>
                    <div id="error-message" class="error-message"></div>
                    <button id="retry-btn" class="btn btn-secondary">Réessayer</button>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <span>Powered by</span>
                <a href="https://huggingface.co/pyannote/speaker-diarization-3.1" target="_blank" rel="noopener" class="footer-link">
                    <strong>pyannote</strong>
                </a>
                <span>· Speaker Diarization 3.1</span>
                <span>·</span>
                <a href="https://github.com/pyannote/pyannote-audio" target="_blank" rel="noopener" class="footer-link">MIT License</a>
            </div>
        </footer>
    </div>

    <!-- WaveSurfer.js -->
    <script src="https://unpkg.com/wavesurfer.js@7"></script>
    <script src="https://unpkg.com/wavesurfer.js@7/dist/plugins/regions.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
